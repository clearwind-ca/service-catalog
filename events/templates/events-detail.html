{% extends "base-two-column.html" %}
{% load octicons %}
{% load crispy_forms_tags %}
{% load helpers %}
{% block breadcrumbs %}
    <li class="breadcrumb-item"><a href="{% url 'events:events-list' %}">{% octicon "graph" %} Events</a></li>
    <li class="breadcrumb-item">Event</li>
{% endblock %}

{% block top %}
    <h2>{{ event.name }}</h2>
    <h4>
        {% include "active.html" with active=event.active %}
        {% include "customers.html" with impacts=event.customers %}
    </h4>
    {% if event.source %}<b>Source:</b> {{ event.source }}{% endif %}
{% endblock %}

{% block main %}
<p>{{ event.description|markdown|safe }}</p>
<p>{% if event.url %}<a href="{{ event.url }}">{{ event.url|truncatechars:50 }} {% octicon "link-external" %}</a>{% else %}None{% endif %}
<p>
    {% if event.start and event.end %}
    <b>Started:</b> {% include "since.html" with since=event.start %} <br>
    <b>Finished:</b> {% include "since.html" with since=event.end %} <br>
    <b>Duration:</b> {{ event.start|timesince:event.end}}
    {% else %}
        {% octicon "clock" %}{% include "since.html" with since=event.start %}
    {% endif %}
</dl>

{% if services %}
<div class="card mt-3 mb-3">
    <div class="card-header fw-bold">Services</div>
    <div class="card-body">
        {% with services=event.services.all %}
            {% include "services.html" with services=services %}
            <p class="form-text">{% octicon "info" %} Services affected by this event.</p>
        {% endwith %}
    </div>
</div>
{% endif %}

{% endblock %}

{% block sidebar %}
<div class="pb-3">
    <h5 class="text-muted border-bottom">Info</h5>
    <p>Primary key: <code>{{ event.pk }}</code></p>
    {% if event.external_id %}
    <p>External id: <code>{{ event.external_id }}</code></p>
    {% endif %}
    <p>Type: <code>{{ event.type|capfirst }}</code></p>
    {% if event.status %}
    <p>Status: <code>{{ event.status }}</code>
    {% endif %}
</div>

{% include "logs.html" with no_message="No logs found for this event." pk=event.pk type="event" %}

{% if perms.events.change_event %}
    <div>
        <h5 class="text-muted border-bottom">Admin</h5>
        <p><a href="{% url 'events:events-update' event.pk %}">Update this event</a></p>
    </div>
{% endif %}

{% endblock %}